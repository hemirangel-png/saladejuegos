<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conversaciones con Sentido</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }
        
        body {
            background-image: url('https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80');
            background-size: cover;
            background-position: center;
            min-height: 100vh;
            color: white;
            padding: 15px;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* HEADER MINI */
        .header {
            background: rgba(255, 255, 255, 0.15);
            padding: 12px;
            border-radius: 10px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            text-align: center;
        }

        .codigo-sala {
            background: rgba(39, 174, 96, 0.9);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 700;
            letter-spacing: 1px;
            margin-top: 5px;
            display: inline-block;
        }

        /* TARJETA DE PREGUNTA PRINCIPAL */
        .pregunta-container {
            background: rgba(255, 255, 255, 0.15);
            padding: 25px;
            border-radius: 12px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            text-align: center;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .topico-titulo {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 8px;
        }

        .pregunta-texto {
            font-size: 22px;
            font-weight: 600;
            line-height: 1.3;
        }

        /* LISTA HORIZONTAL DE PARTICIPANTES */
        .participantes-container {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            padding: 15px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .participantes-lista {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            max-height: 120px;
            overflow-y: auto;
        }

        .participante {
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            font-size: 14px;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .participante.activo {
            background: #27ae60;
            color: white;
            font-weight: 600;
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(39, 174, 96, 0.5);
        }

        /* TURNO ACTUAL */
        .turno-actual {
            background: rgba(155, 89, 182, 0.3);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .participante-actual {
            font-size: 18px;
            font-weight: 700;
            color: #9b59b6;
            margin-top: 5px;
        }

        /* BOT√ìN SIGUIENTE */
        .btn-siguiente {
            background: #3498db;
            color: white;
            border: none;
            padding: 15px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            width: 100%;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .btn-siguiente:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        /* BOT√ìN VOLVER AL INICIO */
        .btn-volver-inicio {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.4);
            padding: 12px;
            font-size: 14px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            width: 100%;
            transition: all 0.3s ease;
        }

        .btn-volver-inicio:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        /* ANIMACI√ìN */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulsando {
            animation: pulse 2s infinite;
        }

        /* MENSAJE INFORMATIVO */
        .mensaje-info {
            background: rgba(52, 152, 219, 0.3);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            font-size: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER MINI -->
        <div class="header">
            <div style="font-size: 18px; font-weight: 600;">Conversaciones</div>
            <div class="codigo-sala" id="codigoSala">ABC123</div>
        </div>

        <!-- TURNO ACTUAL -->
        <div class="turno-actual">
            <div>üé§ Turno de:</div>
            <div class="participante-actual" id="participanteActual">Cargando...</div>
        </div>

        <!-- MENSAJE INFORMATIVO (solo aparece si no hay t√≥pico) -->
        <div class="mensaje-info" id="mensajeInfo" style="display: none;">
            üí° <strong>Sala General</strong> - Pide al facilitador que comparta el link completo
        </div>

        <!-- TARJETA DE PREGUNTA PRINCIPAL -->
        <div class="pregunta-container">
            <div class="topico-titulo" id="topicoTitulo">FAMILIA</div>
            <div class="pregunta-texto" id="preguntaTexto">
                Cargando pregunta...
            </div>
        </div>

        <!-- LISTA HORIZONTAL DE PARTICIPANTES -->
        <div class="participantes-container">
            <div style="font-size: 14px; margin-bottom: 10px; text-align: center; color: rgba(255,255,255,0.8);">
                Participantes
            </div>
            <div class="participantes-lista" id="listaParticipantes">
                <!-- Los participantes se cargan din√°micamente -->
            </div>
        </div>

        <!-- BOT√ìN SIGUIENTE -->
        <button class="btn-siguiente" onclick="siguienteTurno()">
            Siguiente Turno
        </button>

        <!-- BOT√ìN VOLVER AL INICIO -->
        <button class="btn-volver-inicio" onclick="volverAlInicio()">
            ‚Üê Volver al Inicio
        </button>
    </div>

    <script>
        // PARTICIPANTES REALES - se cargan desde la URL
        let participantes = [];
        let turnoActual = 1;
        let topicoActual = '';

        // INICIALIZACI√ìN CORREGIDA
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const codigo = urlParams.get('codigo');
            const topico = urlParams.get('topico');
            const nombreParticipante = urlParams.get('participante');
            const esFacilitador = urlParams.get('creador') === 'true';

            document.getElementById('codigoSala').textContent = codigo || 'SIN C√ìDIGO';
            
            // MANEJO MEJORADO DE T√ìPICOS
            if (topico) {
                // Si hay t√≥pico en la URL, usarlo
                topicoActual = topico;
                document.getElementById('topicoTitulo').textContent = topicoActual.toUpperCase();
                document.getElementById('mensajeInfo').style.display = 'none';
            } else {
                // Si NO hay t√≥pico, mostrar sala general
                topicoActual = 'general';
                document.getElementById('topicoTitulo').textContent = 'SALA GENERAL';
                document.getElementById('mensajeInfo').style.display = 'block';
                
                // Preguntas generales para sala sin t√≥pico
                const preguntasGenerales = [
                    "¬øQu√© te hace sentir agradecido hoy?",
                    "¬øCu√°l ha sido tu aprendizaje m√°s reciente?",
                    "¬øQu√© momento reciente te ha hecho feliz?",
                    "¬øQu√© valor es importante para ti?",
                    "¬øQu√© te gustar√≠a mejorar en tu vida?",
                    "¬øQu√© experiencia te ha marcado positivamente?",
                    "¬øQu√© sue√±o o meta tienes actualmente?"
                ];
                // Guardar para usar despu√©s
                window.preguntasGenerales = preguntasGenerales;
            }
            
            // CARGAR PARTICIPANTES REALES
            if (esFacilitador) {
                // El facilitador inicia la lista con su nombre
                participantes = [{ id: 1, nombre: nombreParticipante || 'Facilitador' }];
            } else {
                // Para participantes, solo mostramos al participante actual
                participantes = [
                    { id: 1, nombre: nombreParticipante || 'T√∫' }
                ];
            }
            
            cargarPregunta(topicoActual);
            cargarParticipantes();
            actualizarInterfaz();
        });

        // CARGAR LISTA DE PARTICIPANTES
        function cargarParticipantes() {
            const lista = document.getElementById('listaParticipantes');
            lista.innerHTML = '';
            
            participantes.forEach(participante => {
                const span = document.createElement('span');
                span.className = 'participante';
                span.textContent = participante.nombre;
                span.id = `participante-${participante.id}`;
                lista.appendChild(span);
            });
        }

        // CARGAR PREGUNTA ALEATORIA - CORREGIDA
        function cargarPregunta(topico) {
            let pregunta = '';
            
            if (topico === 'general') {
                // Preguntas generales para sala sin t√≥pico espec√≠fico
                const preguntasGenerales = window.preguntasGenerales || [
                    "¬øQu√© te hace sentir agradecido hoy?",
                    "¬øCu√°l ha sido tu aprendizaje m√°s reciente?",
                    "¬øQu√© momento reciente te ha hecho feliz?",
                    "¬øQu√© valor es importante para ti?",
                    "¬øQu√© te gustar√≠a mejorar en tu vida?",
                    "¬øQu√© experiencia te ha marcado positivamente?",
                    "¬øQu√© sue√±o o meta tienes actualmente?"
                ];
                pregunta = preguntasGenerales[Math.floor(Math.random() * preguntasGenerales.length)];
            } else {
                // Preguntas espec√≠ficas por t√≥pico
                const preguntas = {
                    'familia': [
                        "¬øCu√°l es tu recuerdo m√°s valioso con tu familia?",
                        "¬øQu√© tradici√≥n familiar te gusta m√°s?",
                        "¬øQu√© aprendiste de tus padres?",
                        "¬øQu√© significa 'hogar' para ti?",
                        "¬øQu√© momento familiar te ha marcado m√°s?",
                        "¬øQu√© valor familiar quieres conservar?",
                        "¬øC√≥mo ha influido tu familia en tu vida?"
                    ],
                    'espiritualidad': [
                        "¬øQu√© te da paz interior?",
                        "¬øC√≥mo encuentras significado en la vida?",
                        "¬øQu√© creencias te gu√≠an?",
                        "¬øQu√© te conecta con algo mayor?",
                        "¬øQu√© pr√°ctica espiritual te nutre?",
                        "¬øC√≥mo defines tu prop√≥sito?",
                        "¬øQu√© experiencia te hizo sentir conectado?"
                    ],
                    'pareja': [
                        "¬øQu√© valoras m√°s en una relaci√≥n?",
                        "¬øC√≥mo construyes confianza?",
                        "¬øQu√© has aprendido del amor?",
                        "¬øQu√© hace especial una relaci√≥n?",
                        "¬øC√≥mo manejas los conflictos?",
                        "¬øQu√© significa amar para ti?",
                        "¬øQu√© cualidad buscas en una pareja?"
                    ],
                    'padre_hijos': [
                        "¬øQu√© te gusta de ser padre/hijo?",
                        "¬øQu√© valor quieres transmitir?",
                        "¬øC√≥mo es tu relaci√≥n familiar?",
                        "¬øQu√© consejo dar√≠as sobre familia?",
                        "¬øQu√© momento con tus hijos/padres atesoras?",
                        "¬øC√≥mo equilibras los roles familiares?",
                        "¬øQu√© has aprendido de tu familia?"
                    ],
                    'colegio': [
                        "¬øQu√© maestro recuerdas con cari√±o?",
                        "¬øQu√© aprendiste en la escuela que usas hoy?",
                        "¬øQu√© experiencia escolar fue importante?",
                        "¬øQu√© recuerdo escolar te hace feliz?",
                        "¬øQu√© amistad escolar marc√≥ tu vida?",
                        "¬øQu√© lecci√≥n del colegio aplicas a√∫n?",
                        "¬øC√≥mo fue tu primer d√≠a de escuela?"
                    ],
                    'desarrollo_personal': [
                        "¬øQu√© meta te emociona?",
                        "¬øQu√© h√°bito mejor√≥ tu vida?",
                        "¬øQu√© te gustar√≠a aprender?",
                        "¬øC√≥mo superas desaf√≠os?",
                        "¬øQu√© miedo has vencido?",
                        "¬øQu√© te hace sentir realizado?",
                        "¬øC√≥mo te cuidas a ti mismo?"
                    ]
                };

                const preguntasTopico = preguntas[topico] || preguntas.familia;
                pregunta = preguntasTopico[Math.floor(Math.random() * preguntasTopico.length)];
            }
            
            document.getElementById('preguntaTexto').textContent = pregunta;
        }

        // SIGUIENTE TURNO
        function siguienteTurno() {
            // Encontrar siguiente participante
            const indiceActual = participantes.findIndex(p => p.id === turnoActual);
            const siguienteIndice = (indiceActual + 1) % participantes.length;
            
            turnoActual = participantes[siguienteIndice].id;
            actualizarInterfaz();

            // Si es el primero, cambiar pregunta
            if (siguienteIndice === 0) {
                cargarPregunta(topicoActual);
            }
        }

        // ACTUALIZAR INTERFAZ
        function actualizarInterfaz() {
            const participanteActualElem = document.getElementById('participanteActual');
            
            // Quitar clase activa de todos
            document.querySelectorAll('.participante').forEach(p => {
                p.classList.remove('activo');
                p.classList.remove('pulsando');
            });
            
            // Agregar clase activa al participante actual
            const participanteActual = document.getElementById(`participante-${turnoActual}`);
            if (participanteActual) {
                participanteActual.classList.add('activo');
                participanteActual.classList.add('pulsando');
            }

            // Actualizar turno actual
            const participante = participantes.find(p => p.id === turnoActual);
            if (participante) {
                participanteActualElem.textContent = participante.nombre;
                participanteActualElem.classList.add('pulsando');
            }
        }

        // VOLVER AL INICIO
        function volverAlInicio() {
            if (confirm('¬øVolver al inicio? Se perder√° el progreso de la conversaci√≥n.')) {
                window.location.href = 'index.html';
            }
        }

        // INICIAR CON EL PRIMER PARTICIPANTE
        setTimeout(() => {
            if (participantes.length > 0) {
                turnoActual = participantes[0].id;
                actualizarInterfaz();
            }
        }, 100);
    </script>
</body>
</html>